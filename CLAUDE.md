# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

Vigilo is a Flutter application generated by OneWeekApp AI Software Factory. It uses Supabase as the backend, Riverpod for state management, Go Router for navigation, and Hive for local encrypted storage.

## Essential Commands

```bash
# Install dependencies
flutter pub get

# Run the app (flavors: dev, preview, staging, prod)
flutter run --flavor dev

# Run tests
flutter test

# Run tests with coverage
flutter test --coverage

# Run a single test file
flutter test test/features/auth/auth_service_test.dart

# Static analysis (uses very_good_analysis rules)
flutter analyze

# Generate localization files (after editing ARB files)
flutter gen-l10n

# Regenerate code after @freezed/@HiveType/@JsonSerializable changes
dart run build_runner build --delete-conflicting-outputs

# Build for release
flutter build apk --flavor prod --release
flutter build ios --flavor prod --release
flutter build web --release

# Clean and rebuild
flutter clean && flutter pub get
```

## Architecture

```
lib/
├── main.dart                 # App entry point, Supabase/Hive init
├── core/
│   ├── env/                  # Environment variable access (Env.requireEnv)
│   ├── router/               # GoRouter configuration (AppRouter)
│   ├── security/             # Biometric authentication
│   ├── services/             # Permission handling
│   ├── storage/              # HiveStorage (encrypted box support)
│   ├── theme/                # AppTheme (light/dark themes)
│   └── utils/                # SecureStorage, Validator
├── features/                 # Feature modules (auth, home, splash)
│   └── <feature>/
│       ├── data/             # Services (e.g., AuthService)
│       └── presentation/     # Pages/widgets
├── providers/                # Riverpod providers (AuthNotifier, LocaleProvider)
└── l10n/                     # Localization (ARB files + generated)
```

**Key patterns:**
- Services accept dependencies via constructor injection for testability (e.g., `AuthService({GoTrueClient? authClient})`)
- HiveStorage provides AES-encrypted boxes with key rotation support
- Environment config loaded from `assets/env/.env.<flavor>` with filesystem fallback
- Tests use mocktail for mocking Supabase clients

## Environment Configuration

Environment variables in `assets/env/.env.<flavor>` (dev, preview, staging, prod):
```
SUPABASE_URL=your_supabase_url
SUPABASE_ANON_KEY=your_anon_key
```

For local development, create a `.env` or `.env.dev` in the project root (gitignored).

## Tech Stack

| Component | Technology |
|-----------|------------|
| Framework | Flutter 3.9.2+, Dart 3.9.2+ |
| State | Riverpod 3.0+ |
| Navigation | Go Router |
| Backend | Supabase (Auth, Database, Storage) |
| Local Storage | Hive (with AES encryption) |
| Linting | very_good_analysis |
| Testing | flutter_test, mocktail |

## Import Conventions

Use absolute package imports:
```dart
import 'package:vigilo/core/router/app_router.dart';
import 'package:vigilo/features/auth/data/auth_service.dart';
```

## Adding Features

1. Create feature folder in `lib/features/<name>/`
2. Add `data/` for services/repositories
3. Add `presentation/` for pages and widgets
4. Create providers in `lib/providers/`
5. Register routes in `lib/core/router/app_router.dart`
6. Add tests mirroring the structure in `test/features/<name>/`
